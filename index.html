<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Большой тест</title>
  <style>
    .section { display: none; }
    .section.active { display: block; }
    .image-grid {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    .image-grid img {
      width: 100px; /* Подстрой под нужный размер */
      cursor: pointer;
      border: 2px solid transparent;
    }
    .image-grid img.selected {
      border: 2px solid red; /* Подсветка выбранного */
    }
  </style>
</head>
<body>
  <h1>Опрос</h1>

  <!-- Раздел 1: Приветствие -->
  <div class="section active" id="section1">
    <p>Здравствуйте! Приглашаем Вас принять участие в опросе. Опрос состоит из нескольких разделов. Среднее время заполнения — 10-15 минут. Ваше участие очень важно для нас! Благодарим за внимание и участие!</p>
    <button onclick="goToSection(2)">Начать</button>
  </div>

  <!-- Раздел 2: Общие вопросы -->
  <div class="section" id="section2">
    <h2>Общие вопросы</h2>
    <label>
      Укажите Ваш возраст:
      <input type="number" id="age" />
    </label>
    <br><br>
    <label>
      Укажите Ваш биологический пол:
      <select id="gender">
        <option value="">-- Выберите --</option>
        <option value="м">Мужской</option>
        <option value="ж">Женский</option>
      </select>
    </label>
    <br><br>
    <label>
      Укажите Ваш уровень образования:
      <select id="education">
        <option value="">-- Выберите --</option>
        <option value="Среднее">Среднее образование</option>
        <option value="Среднее специальное">Среднее специальное</option>
        <option value="Студент">Студент</option>
        <option value="Высшее">Высшее образование</option>
      </select>
    </label>
    <br><br>
    <button onclick="saveSection2()">Перейти к следующему разделу</button>
  </div>

  <!-- Раздел 3: Инструкция к тесту включённых фигур -->
  <div class="section" id="section3">
    <h2>Тест включённых фигур</h2>
    <p>
      Вам будут предъявлены сложные фигуры (изображения). В каждой из них спрятан один из простых эталонов.
      Вы должны определить, какой из элементов содержится в рисунке, и указать его.
    </p>
    <p>
      <b>Помните:</b>  
      - Эталон будет примерно такого же размера и такого же расположения, как в образце.  
      - В каждом рисунке только один эталон.  
      - Время выполнения теста учитывается!
    </p>
    <button onclick="startFiguresTest()">Начать тест включённых фигур</button>
  </div>

  <!-- Раздел 4: Сам тест включённых фигур -->
  <div class="section" id="section4">
    <h2>Тест включённых фигур — вопросы</h2>
    <p>Ниже упрощённый пример на 2 изображения (в реальности у вас будет 30).</p>

    <!-- Место для динамического вывода фигур -->
    <div id="figureTestContainer"></div>

    <button onclick="finishFiguresTest()">Завершить тест включённых фигур</button>
  </div>

  <!-- Раздел 5: Завершение теста фигур -->
  <div class="section" id="section5">
    <h2>Тест включённых фигур пройден!</h2>
    <p>Переходите к следующему разделу.</p>
    <button onclick="goToSection(6)">Перейти к следующему разделу</button>
  </div>

  <!-- Раздел 6: Инструкция к оценке произведений искусства -->
  <div class="section" id="section6">
    <h2>Оценка произведений искусства</h2>
    <p>
      Следующий раздел будет посвящён оценке произведений искусства. Ваше участие займёт около 15 минут.  
      Вам будет предложено оценить финансовую стоимость нескольких произведений искусства по шкале от 1 (совсем не дорого) до 10 (очень дорого).  
      После этого вы ответите на несколько демографических вопросов.  
      Ваши ответы будут анонимны и будут использованы только для научных целей. Спасибо!
    </p>
    <!-- 50/50 картинка рядом с инструкцией -->
    <div id="artInstructionImage" style="margin: 10px 0;"></div>

    <button onclick="goToSection(7)">Начать оценку</button>
  </div>

  <!-- Раздел 7: Оценка произведений искусства -->
  <div class="section" id="section7">
    <h2>Оценка произведений искусства</h2>
    <p>Здесь пример на 2 картины (в реальности у вас 6).</p>
    <div id="artRatingContainer"></div>
    <button onclick="submitAllData()">Отправить результаты</button>
  </div>

  <!-- Скрипт для логики переключения и сбора данных -->
  <script>
    // Глобальный объект, где будем хранить все ответы
    const surveyData = {
      startFiguresTime: 0,  // Время начала теста включённых фигур (мс)
      endFiguresTime: 0,    // Время окончания
      figuresAnswers: [],   // Массив ответов (какой эталон выбрал)
      artRatings: [],       // Оценки произведений искусства
      showArtInstructionImage: false, // Показывалась ли картинка в разделе 6
    };

    // Показываем/скрываем разделы
    function goToSection(num) {
      document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
      document.getElementById("section" + num).classList.add("active");
    }

    // Сохраняем данные раздела 2
    function saveSection2() {
      surveyData.age = document.getElementById("age").value.trim();
      surveyData.gender = document.getElementById("gender").value;
      surveyData.education = document.getElementById("education").value;

      goToSection(3);
    }

    // Когда нажимаем "Начать тест включённых фигур"
    function startFiguresTest() {
      // Засекаем время
      surveyData.startFiguresTime = Date.now();
      // Переходим к разделу 4
      goToSection(4);
      renderFiguresTest();
    }

    // Пример данных для теста включённых фигур (упрощённо, 2 картинки)
    const figureTestData = [
      {
        id: 1,
        bigImage: "images/figure1.png",
        options: [
          "images/optionA.png",
          "images/optionB.png",
          "images/optionC.png",
          "images/optionD.png",
          "images/optionE.png",
        ]
      },
      {
        id: 2,
        bigImage: "images/figure2.png",
        options: [
          "images/optionA.png",
          "images/optionB.png",
          "images/optionC.png",
          "images/optionD.png",
          "images/optionE.png",
        ]
      }
    ];

    // Рисуем вопросы для теста включённых фигур
    function renderFiguresTest() {
      const container = document.getElementById("figureTestContainer");
      container.innerHTML = "";

      figureTestData.forEach((fig, index) => {
        const figDiv = document.createElement("div");
        figDiv.style.border = "1px solid #ccc";
        figDiv.style.marginBottom = "20px";
        figDiv.style.padding = "10px";

        // Заголовок
        const title = document.createElement("h3");
        title.textContent = `Фигура №${index + 1}`;
        figDiv.appendChild(title);

        // Большая картинка
        const bigImg = document.createElement("img");
        bigImg.src = fig.bigImage;
        bigImg.style.width = "200px";
        figDiv.appendChild(bigImg);

        // Сетка с 5 вариантами
        const grid = document.createElement("div");
        grid.className = "image-grid";

        fig.options.forEach((optionSrc, optIndex) => {
          const optImg = document.createElement("img");
          optImg.src = optionSrc;
          optImg.addEventListener("click", () => {
            // Сохраняем выбор
            surveyData.figuresAnswers[index] = optIndex; 
            // Подсвечиваем выбранную
            grid.querySelectorAll("img").forEach(img => img.classList.remove("selected"));
            optImg.classList.add("selected");
          });
          grid.appendChild(optImg);
        });

        figDiv.appendChild(grid);
        container.appendChild(figDiv);
      });
    }

    // Завершаем тест включённых фигур
    function finishFiguresTest() {
      surveyData.endFiguresTime = Date.now();
      goToSection(5);
    }

    // Раздел 6: 50/50 показывать картинку
    // Вызывается, когда мы заходим в раздел 6
    // (в нашем примере просто при загрузке страницы)
    window.addEventListener("DOMContentLoaded", () => {
      // 50% вероятность
      surveyData.showArtInstructionImage = Math.random() < 0.5;
      if (surveyData.showArtInstructionImage) {
        const img = document.createElement("img");
        img.src = "images/art_instructions.png";
        img.style.width = "200px";
        document.getElementById("artInstructionImage").appendChild(img);
      }
    });

    // Раздел 7: Оценка произведений искусства
    // Пример на 2 картины
    const artData = [
      { id: 1, src: "images/art1.jpg" },
      { id: 2, src: "images/art2.jpg" },
    ];

    // При входе в раздел 7 — рендерим эти картины
    function renderArtRatings() {
      const container = document.getElementById("artRatingContainer");
      container.innerHTML = "";

      artData.forEach((art, index) => {
        const artDiv = document.createElement("div");
        artDiv.style.marginBottom = "20px";

        const title = document.createElement("h3");
        title.textContent = `Картина №${index + 1}`;
        artDiv.appendChild(title);

        const artImg = document.createElement("img");
        artImg.src = art.src;
        artImg.style.width = "200px";
        artDiv.appendChild(artImg);

        // Радио-кнопки 1-10
        const ratingDiv = document.createElement("div");
        for (let i = 1; i <= 10; i++) {
          const label = document.createElement("label");
          label.style.marginRight = "5px";

          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = "artRating" + index;
          radio.value = i.toString();

          radio.addEventListener("change", () => {
            surveyData.artRatings[index] = i; // Сохраняем выбранную оценку
          });

          label.appendChild(radio);
          label.appendChild(document.createTextNode(i + " "));
          ratingDiv.appendChild(label);
        }
        artDiv.appendChild(ratingDiv);

        container.appendChild(artDiv);
      });
    }

    // Когда заходим в раздел 7 (через кнопку "Начать оценку")
    function goToSection7() {
      goToSection(7);
      renderArtRatings();
    }

    // Переопределяем кнопку в разделе 6
    function goToSection(num) {
      // Стандартное переключение
      document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
      document.getElementById("section" + num).classList.add("active");

      // Доп.логика: если переходим в 7, рендерим картинки
      if (num === 7) {
        renderArtRatings();
      }
    }

    // Финальная отправка всех данных
    async function submitAllData() {
      // Считаем общее время теста включённых фигур
      const figuresTimeSec = (surveyData.endFiguresTime - surveyData.startFiguresTime) / 1000;
      surveyData.figuresTimeSec = figuresTimeSec;

      // Теперь отправляем всё на сервер
      try {
        const response = await fetch("/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(surveyData),
        });

        if (response.ok) {
          alert("Данные успешно отправлены! Спасибо за участие.");
        } else {
          alert("Ошибка при отправке данных.");
        }
      } catch (error) {
        console.error("Ошибка:", error);
        alert("Произошла ошибка при отправке.");
      }
    }
  </script>
</body>
</html>
