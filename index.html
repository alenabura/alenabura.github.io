<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Опрос</title>
  <style>
    .section { display: none; }
    .section.active { display: block; }
    .image-grid {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }
    .image-grid img {
      width: 100px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
      background: rgba(0,0,0,0.1);
      border-radius: 4px;
    }
    .image-grid img:hover {
      filter: brightness(0.9);
      border-color: #888;
    }
    .image-grid img.selected {
      border: 2px solid red !important;
    }
    .rating-options label {
      margin: 0 5px;
      cursor: pointer;
    }
    .rating-options span {
      margin: 0 10px;
      font-weight: bold;
    }
    .progress-info {
      margin: 10px 0;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- Раздел 1: Приветствие -->
  <div class="section active" id="section1">
    <p>Здравствуйте! Приглашаем Вас принять участие в опросе. Опрос состоит из нескольких разделов. Среднее время заполнения — 10-15 минут. Ваше участие очень важно для нас! Благодарим за внимание и участие!</p>
    <button onclick="goToSection(2)">Начать</button>
  </div>

  <!-- Раздел 2: Общие вопросы -->
  <div class="section" id="section2">
    <h2>Общие вопросы</h2>
    <label>
      Укажите Ваш возраст:
      <input type="number" id="age" />
    </label>
    <br><br>
    <div>
      Укажите Ваш биологический пол:
      <label><input type="radio" name="gender" value="м"> Мужской</label>
      <label><input type="radio" name="gender" value="ж"> Женский</label>
    </div>
    <br>
    <div>
      Укажите Ваш уровень образования:
      <label><input type="radio" name="education" value="Среднее"> Среднее образование</label>
      <label><input type="radio" name="education" value="Среднее специальное"> Среднее специальное</label>
      <label><input type="radio" name="education" value="Студент"> Студент</label>
      <label><input type="radio" name="education" value="Высшее"> Высшее образование</label>
    </div>
    <br>
    <button onclick="saveSection2()">Перейти к следующему разделу</button>
  </div>

  <!-- Раздел 3: Инструкция к тесту включённых фигур -->
  <div class="section" id="section3">
    <h1>ТЕСТ ВКЛЮЧЁННЫХ ФИГУР</h1>
    <h2>Инструкция</h2>
    <p>Вам будут предъявлены сложные фигуры (изображения), в каждой из которых имеется один из простых эталонов.</p>
    <p>Вы должны найти в каждом случае, какой из этих элементов содержится в рисунке, и указать его.</p>
    <p>В каждом сложном рисунке имеется один из следующих элементов:</p>
    <div class="image-grid">
      <img src="https://alenabura.github.io/images/1.1.png" alt="Эталон 1">
      <img src="https://alenabura.github.io/images/1.2.png" alt="Эталон 2">
      <img src="https://alenabura.github.io/images/1.3.png" alt="Эталон 3">
      <img src="https://alenabura.github.io/images/1.4.png" alt="Эталон 4">
      <img src="https://alenabura.github.io/images/1.5.png" alt="Эталон 5">
    </div>
    <p>Укажите в каждом случае, какой из этих элементов содержится в рисунке. Например:</p>
    <div>
      <img src="https://alenabura.github.io/images/primer.png" alt="Пример" style="width:150px;">
    </div>
    <br>
    <p>Помните:</p>
    <ul>
      <li>В каждом рисунке имеется один из элементов приблизительно той же величины(*) и так же расположенный, как на образце.</li>
      <li>В каждом рисунке имеется только один из элементов.</li>
      <li>Время выполнения теста учитывается при расчёте результата.</li>
    </ul>
    <p>(*) При прохождении теста на мобильных устройствах размеры образцов будут меньше, чем на фигуре.</p>
    <button onclick="startFiguresTest()">Начать тест включённых фигур</button>
  </div>

  <!-- Раздел 4: Тест включённых фигур -->
  <div class="section" id="section4">
    <h2>Тест включённых фигур — вопросы</h2>
    <div class="progress-info" id="figureProgress"></div>
    <div id="figureTestContainer"></div>
  </div>

  <!-- Раздел 5: Завершение теста включённых фигур -->
  <div class="section" id="section5">
    <h2>Вы завершили тест включённых фигур</h2>
    <button onclick="goToSection(6)">Перейти к следующему разделу</button>
  </div>

  <!-- Раздел 6: Инструкция к тесту оценивания искусства -->
  <div class="section" id="section6">
    <h2>Оценка произведений искусства</h2>
    <p>
      Следующий раздел будет посвящён оценке произведений искусства. Ваше участие займёт около 15 минут.
      Вам будет предложено оценить финансовую стоимость нескольких произведений искусства по шкале от 1 (совсем не дорого) до 10 (очень дорого).
      После этого Вы ответите на несколько демографических вопросов. Ваши ответы будут анонимны и будут использованы только для научных целей. Спасибо!
    </p>
    <div id="artInstructionImages"></div>
    <button onclick="startArtRatingTest()">Начать оценивание картин</button>
  </div>

  <!-- Раздел 7: Тест оценивания искусства -->
  <div class="section" id="section7">
    <h2>Оценка произведений искусства</h2>
    <div class="progress-info" id="artProgress"></div>
    <div id="artRatingContainer"></div>
    <button id="finishArtButton" style="display: none;" onclick="finishArtTest()">Завершить тест</button>
  </div>

  <!-- Раздел 8: Завершение опроса -->
  <div class="section" id="section8">
    <h2>Спасибо за участие!</h2>
    <p>Ваши данные успешно отправлены.</p>
  </div>

  <script>
    // Глобальный объект для хранения данных опроса
    const surveyData = {
      age: null,
      gender: null,
      education: null,
      figuresAnswers: [],
      figuresStartTime: 0,
      figuresEndTime: 0,
      artRatings: [],
      primerShown: false, // добавляем признак показа прайминга
      figuresDuration: 0  // длительность выполнения теста включённых фигур
    };

    // Функция переключения разделов
    function goToSection(num) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById('section' + num).classList.add('active');
    }

    // Сохраняем данные раздела 2 и переходим к разделу 3
    function saveSection2() {
      surveyData.age = document.getElementById('age').value.trim();
      surveyData.gender = document.querySelector('input[name="gender"]:checked')?.value;
      surveyData.education = document.querySelector('input[name="education"]:checked')?.value;
      goToSection(3);
    }

    // Раздел 4: Тест включённых фигур
    let currentFigure = 1;
    const totalFigures = 30;

    function startFiguresTest() {
      surveyData.figuresStartTime = Date.now();
      currentFigure = 1;
      renderFigureTest();
      goToSection(4);
    }

    function renderFigureTest() {
      const container = document.getElementById('figureTestContainer');
      container.innerHTML = '';
      
      // Добавляем информацию о прогрессе
      document.getElementById('figureProgress').textContent = `Картинка ${currentFigure} из ${totalFigures}`;

      // Основное изображение теста
      const mainImg = document.createElement('img');
      mainImg.src = `https://alenabura.github.io/images/${currentFigure}.png`;
      mainImg.style.width = '300px';
      container.appendChild(mainImg);

      // Сетка вариантов ответа
      const optionsDiv = document.createElement('div');
      optionsDiv.className = 'image-grid';
      const options = ['1.1.png', '1.2.png', '1.3.png', '1.4.png', '1.5.png'];
      options.forEach((option, index) => {
        const optImg = document.createElement('img');
        optImg.src = `https://alenabura.github.io/images/${option}`;
        optImg.alt = `Опция ${index + 1}`;
        optImg.addEventListener('click', () => {
          surveyData.figuresAnswers.push({ figure: currentFigure, option: index + 1 });
          currentFigure++;
          if (currentFigure <= totalFigures) {
            renderFigureTest();
          } else {
            surveyData.figuresEndTime = Date.now();
            goToSection(5);
          }
        });
        optionsDiv.appendChild(optImg);
      });
      container.appendChild(optionsDiv);
    }

    // Раздел 6: При загрузке проверяем вероятность показа картинок для инструкции по искусству
 window.addEventListener('DOMContentLoaded', () => {
  const artImagesDiv = document.getElementById('artInstructionImages');

  if (Math.random() < 0.5) { // 50% вероятность показа
    const carImg = document.createElement('img');
    carImg.src = 'https://alenabura.github.io/images/car.png';
    carImg.style.width = '150px';
    const shopImg = document.createElement('img');
    shopImg.src = 'https://alenabura.github.io/images/shop.png';
    shopImg.style.width = '150px';
    artImagesDiv.appendChild(carImg);
    artImagesDiv.appendChild(shopImg);

    surveyData.primerShown = true; // Теперь правильно записываем
  } else {
    surveyData.primerShown = false;
  }
});


    // Раздел 7: Тест оценивания искусства
    let currentArt = 1;
    const totalArt = 6;

    function startArtRatingTest() {
      currentArt = 1;
      renderArtRating();
      goToSection(7);
    }

    function renderArtRating() {
      const container = document.getElementById('artRatingContainer');
      container.innerHTML = '';
      
      // Добавляем информацию о прогрессе
      document.getElementById('artProgress').textContent = `Картина ${currentArt} из ${totalArt}`;

      // Изображение произведения искусства
      const artImg = document.createElement('img');
      artImg.src = `https://alenabura.github.io/images/${currentArt}p.png`;
      artImg.style.width = '300px';
      container.appendChild(artImg);
      
      // Оценочная шкала от 1 до 10
      const ratingDiv = document.createElement('div');
      ratingDiv.className = 'rating-options';
      const leftLabel = document.createElement('span');
      leftLabel.textContent = 'Очень дёшево';
      ratingDiv.appendChild(leftLabel);
      
      for (let i = 1; i <= 10; i++) {
        const label = document.createElement('label');
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = 'artRating';
        radio.value = i;
        radio.addEventListener('change', () => {
          surveyData.artRatings.push({ art: currentArt, rating: i });
          currentArt++;
          if (currentArt <= totalArt) {
            renderArtRating();
          } else {
            document.getElementById('finishArtButton').style.display = 'block';
          }
        });
        label.appendChild(radio);
        label.appendChild(document.createTextNode(i));
        ratingDiv.appendChild(label);
      }
      
      const rightLabel = document.createElement('span');
      rightLabel.textContent = 'Очень дорого';
      ratingDiv.appendChild(rightLabel);
      
      container.appendChild(ratingDiv);
    }

    // Функция для отправки данных на Google Таблицу
 function sendData() {
  const url = "https://script.google.com/macros/s/AKfycbyc74qvyM0I9YfPn0TVS6qODZIZEt8JfogsTyicfUC_2b91dsWYwtxH8xzQMw6fOnv28w/exec"; 

  const dataToSend = {
    age: surveyData.age,
    gender: surveyData.gender,
    education: surveyData.education,
    showArtInstructionImage: surveyData.primerShown, // меняем название
    figuresTimeSec: surveyData.figuresDuration, // меняем название
    figuresAnswers: surveyData.figuresAnswers.join(","), // превращаем в строку
    artRatings: surveyData.artRatings.join(",") // превращаем в строку
  };

  fetch(url, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(dataToSend)
  })
  .then(response => response.text()) // Получаем текст, чтобы увидеть ошибки
  .then(data => console.log("Ответ от сервера:", data))
  .catch(error => console.error("Ошибка при отправке данных:", error));
}


    // Функция завершения теста оценивания искусства
   function finishArtTest() {
  if (surveyData.figuresEndTime === 0) {
    surveyData.figuresEndTime = Date.now();
  }

  surveyData.figuresDuration = (surveyData.figuresEndTime - surveyData.figuresStartTime) / 1000;

  sendData();
  goToSection(8);
}

  </script>

</body>
</html>
