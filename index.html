<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Опрос</title>
  <style>
    /* Ваши стили */
  </style>
</head>
<body>
  <!-- Ваши разделы -->

  <!-- Модальная плашка для уведомлений -->
  <div id="modal" style="display: none; position: fixed; bottom: 20px; right: 20px; background-color: #4CAF50; color: white; padding: 15px; border-radius: 5px; z-index: 1000;">
    Данные успешно отправлены!
  </div>

  <script>
    // Глобальный объект для хранения данных опроса
    const surveyData = {
      age: null,
      gender: null,
      education: null,
      figuresAnswers: [],
      figuresStartTime: 0,
      figuresEndTime: 0,
      artRatings: [],
      showArtInstructionImage: false // Добавляем флаг для показа изображений
    };

    // Функция переключения разделов
    function goToSection(num) {
      document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
      document.getElementById('section' + num).classList.add('active');
    }

    // Сохраняем данные раздела 2 и переходим к разделу 3
    function saveSection2() {
      surveyData.age = document.getElementById('age').value.trim();
      surveyData.gender = document.querySelector('input[name="gender"]:checked')?.value;
      surveyData.education = document.querySelector('input[name="education"]:checked')?.value;
      goToSection(3);
    }

    // Раздел 4: Тест включённых фигур
    let currentFigure = 1;
    const totalFigures = 30;

    function startFiguresTest() {
      surveyData.figuresStartTime = Date.now();
      currentFigure = 1;
      renderFigureTest();
      goToSection(4);
    }

    function renderFigureTest() {
      const container = document.getElementById('figureTestContainer');
      container.innerHTML = '';
      
      // Добавляем информацию о прогрессе
      document.getElementById('figureProgress').textContent = `Картинка ${currentFigure} из ${totalFigures}`;

      // Основное изображение теста
      const mainImg = document.createElement('img');
      mainImg.src = `https://alenabura.github.io/images/${currentFigure}.png`;
      mainImg.style.width = '300px';
      container.appendChild(mainImg);

      // Сетка вариантов ответа
      const optionsDiv = document.createElement('div');
      optionsDiv.className = 'image-grid';
      const options = ['1.1.png', '1.2.png', '1.3.png', '1.4.png', '1.5.png'];
      options.forEach((option, index) => {
        const optImg = document.createElement('img');
        optImg.src = `https://alenabura.github.io/images/${option}`;
        optImg.alt = `Опция ${index + 1}`;
        optImg.addEventListener('click', () => {
          surveyData.figuresAnswers.push(index + 1); // Сохраняем только номер ответа
          currentFigure++;
          if (currentFigure <= totalFigures) {
            renderFigureTest();
          } else {
            surveyData.figuresEndTime = Date.now();
            goToSection(5);
          }
        });
        optionsDiv.appendChild(optImg);
      });
      container.appendChild(optionsDiv);
    }

    // Раздел 6: При загрузке проверяем вероятность показа картинок
    window.addEventListener('DOMContentLoaded', () => {
      if (Math.random() < 0.5) {
        surveyData.showArtInstructionImage = true; // Устанавливаем флаг
        const artImagesDiv = document.getElementById('artInstructionImages');
        const carImg = document.createElement('img');
        carImg.src = 'https://alenabura.github.io/images/car.png';
        carImg.style.width = '150px';
        const shopImg = document.createElement('img');
        shopImg.src = 'https://alenabura.github.io/images/shop.png';
        shopImg.style.width = '150px';
        artImagesDiv.appendChild(carImg);
        artImagesDiv.appendChild(shopImg);
      }
    });

    // Раздел 7: Тест оценивания искусства
    let currentArt = 1;
    const totalArt = 6;

    function startArtRatingTest() {
      currentArt = 1;
      renderArtRating();
      goToSection(7);
    }

    function renderArtRating() {
      const container = document.getElementById('artRatingContainer');
      container.innerHTML = '';
      
      // Добавляем информацию о прогрессе
      document.getElementById('artProgress').textContent = `Картина ${currentArt} из ${totalArt}`;

      // Изображение произведения искусства
      const artImg = document.createElement('img');
      artImg.src = `https://alenabura.github.io/images/${currentArt}p.png`;
      artImg.style.width = '300px';
      container.appendChild(artImg);
      
      // Оценочная шкала от 1 до 10
      const ratingDiv = document.createElement('div');
      ratingDiv.className = 'rating-options';
      const leftLabel = document.createElement('span');
      leftLabel.textContent = 'Очень дёшево';
      ratingDiv.appendChild(leftLabel);
      
      for (let i = 1; i <= 10; i++) {
        const label = document.createElement('label');
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = 'artRating';
        radio.value = i;
        radio.addEventListener('change', () => {
          surveyData.artRatings.push(i); // Сохраняем только оценку
          currentArt++;
          if (currentArt <= totalArt) {
            renderArtRating();
          } else {
            document.getElementById('finishArtButton').style.display = 'block';
          }
        });
        label.appendChild(radio);
        label.appendChild(document.createTextNode(i));
        ratingDiv.appendChild(label);
      }
      
      const rightLabel = document.createElement('span');
      rightLabel.textContent = 'Очень дорого';
      ratingDiv.appendChild(rightLabel);
      
      container.appendChild(ratingDiv);
    }

    // Функция для отображения модальной плашки
    function showModal(message, duration = 3000) {
      const modal = document.getElementById("modal");
      modal.textContent = message;
      modal.style.display = "block";
      setTimeout(() => {
        modal.style.display = "none";
      }, duration);
    }

    // Функция отправки данных в Google Таблицу
    async function sendDataToGoogleSheets(data) {
      const url = 'https://script.google.com/macros/s/AKfycbwIf-GMM4qQeIkLDe2zzTWzMLygz742J7YcTjRZZlafq4V4ISvtIGdQjwr_apA_YzvHGg/exec'; // Вставьте сюда URL вашего веб-приложения
      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
        const result = await response.json();
        if (result.success) {
          showModal("Данные успешно отправлены!");
        } else {
          showModal("Ошибка при отправке данных.", 5000);
        }
      } catch (error) {
        console.error('Ошибка при отправке данных:', error);
        showModal("Произошла ошибка при отправке.", 5000);
      }
    }

    function finishArtTest() {
      // Рассчитываем время выполнения теста фигур
      surveyData.figuresTimeSec = (surveyData.figuresEndTime - surveyData.figuresStartTime) / 1000;

      // Отправляем данные на сервер
      sendDataToGoogleSheets(surveyData);

      // Переходим к разделу 8
      goToSection(8);
    }
  </script>
</body>
</html>
